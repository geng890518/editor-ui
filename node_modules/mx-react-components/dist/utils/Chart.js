'use strict';

var d3 = require('d3');

var Chart = {
  getDataMinMaxValues: function getDataMinMaxValues(data, axis) {
    var max = d3.max(data, function (d) {
      return d[axis];
    });

    var min = d3.min(data, function (d) {
      return d[axis];
    });

    var maxDigits = Math.ceil(max).toString().length - 1;
    var minDigits = Math.floor(min).toString().length - 1;
    var maxMultiplier = Math.pow(10, maxDigits) < 100 ? 100 : Math.pow(10, maxDigits);
    var minMultiplier = Math.pow(10, minDigits) < 100 ? 100 : Math.pow(10, maxDigits);

    max = Math.ceil(max / maxMultiplier) * maxMultiplier;
    min = Math.floor(min / minMultiplier) * minMultiplier;

    return { min: min, max: max };
  },
  getAxisTickValues: function getAxisTickValues(data, axis) {
    var estimatedNumberOfTicks = 6;
    var minMaxValues = this.getDataMinMaxValues(data, axis);
    var range = minMaxValues.max - minMaxValues.min;
    var tempStep = range / estimatedNumberOfTicks;
    var magnitude = Math.floor(Math.log(tempStep) / Math.LN10);
    var magnitudePower = Math.pow(10, magnitude);
    var magnitudeMultiplier = parseInt(tempStep / magnitudePower + 0.5, 10);
    var stepSize = magnitudeMultiplier * magnitudePower;

    var values = [];

    for (var min = minMaxValues.min; min <= minMaxValues.max; min += stepSize) {
      values.push(min);
    }

    return values;
  }
};

module.exports = Chart;